<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‡Ø¬Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ© â€“ Alhijrah Visa & Immigration Services</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" />
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<!-- Lite libs -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<!-- EmailJS -->
<script defer src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
  :root{
    --gold:#ffd700; --gold2:#ffe483; --blue:#0b1e4d; --blue2:#04294a; --ink:#f5deb3; --line:#ffffff2a;
  }
  *{box-sizing:border-box}
  body{font-family:'Cairo',sans-serif;margin:0;background:linear-gradient(135deg,var(--blue),var(--blue2));color:var(--ink)}
  a{color:inherit;text-decoration:none}
  .container{max-width:1000px;margin:auto;padding:28px}
  .card{background:rgba(3,23,58,.95);border:1px solid var(--line);border-radius:16px;box-shadow:0 0 20px #daa52055;padding:22px}
  h1{margin:0 0 10px;color:var(--gold);text-shadow:0 0 8px var(--gold)}
  h2{margin:0 0 12px;color:var(--gold2)}
  .tagline{margin:6px 0 16px;line-height:1.85;opacity:.95}
  label{display:block;margin:.35rem 0 .2rem;font-weight:700}
  input,select,textarea{width:100%;background:#0b1e4d;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px 12px;outline-color:var(--gold)}
  input:focus,select:focus,textarea:focus{box-shadow:0 0 12px #ffd700aa}
  button{cursor:pointer;border:none;border-radius:12px;padding:12px 16px;font-weight:800}
  .btn{background:var(--gold);color:#04294a}
  .btn.sec{background:#0b1e4d;color:#fff;border:1px solid var(--line)}
  .row{display:grid;gap:12px}
  .col-2{grid-template-columns:1fr 1fr}
  .col-3{grid-template-columns:repeat(3,1fr)}
  @media(max-width:840px){.col-2,.col-3{grid-template-columns:1fr}}
  .services{max-height:240px;overflow:auto;border:1px solid var(--line);border-radius:12px;padding:12px;background:#041c3f}
  .svc{background:#0c2a6b;border:1px solid var(--line);border-radius:10px;padding:10px 12px;margin:6px 0;display:flex;justify-content:space-between;align-items:center;gap:10px}
  .svc:hover{background:var(--gold);color:#04294a;box-shadow:0 0 12px #ffd700}
  .muted{opacity:.85;font-size:.95rem}
  .hint{color:#ffe59a;font-size:.95rem;margin:.25rem 0 .6rem}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .progress{height:8px;background:#ffffff1a;border-radius:8px;overflow:hidden;margin:10px 0 16px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--gold),var(--gold2));transition:width .25s}
  .pill{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);background:#0b1e4d;border-radius:999px;padding:6px 10px;margin:4px 6px 0 0}
  .files{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .file{border:1px solid var(--line);border-radius:10px;padding:6px 10px;background:#0b1e4d}
  .toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);background:#05224a;color:#ffd700;border:1px solid #ffd70066;padding:10px 14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.35);z-index:9999;display:none}

  /* Social (left vertical) */
  .social-left{position:fixed;left:12px;top:50%;transform:translateY(-50%);z-index:1000}
  .social-left .stack{display:flex;flex-direction:column;gap:10px}
  .social-left a{width:44px;height:44px;display:grid;place-items:center;border-radius:12px;background:rgba(255,255,255,.12);border:1px solid var(--line);color:#fff;transition:transform .15s, box-shadow .25s}
  .social-left a:hover{transform:translateY(-2px);box-shadow:0 10px 26px rgba(0,0,0,.35)}

  /* Client Card */
  #clientCard{display:none;margin-top:16px}
  .avatar{width:88px;height:88px;border-radius:50%;object-fit:cover;border:2px solid var(--gold);background:#fff}

  /* Footer */
  footer{margin-top:28px;background:rgba(3,23,58,.9);border-top:1px solid #ffffff2a}
  .footer-inner{max-width:1000px;margin:auto;padding:16px 22px}
  .footer-grid{display:grid;gap:12px;grid-template-columns:2fr 1fr 1fr}
  .footer-title{color:var(--gold);font-weight:800;margin-bottom:6px}
  .contact a{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:10px;border:1px solid #ffffff1a;background:#0b1e4d}
  .copy{margin-top:10px;opacity:.85;font-size:.95rem}
  @media(max-width:900px){.footer-grid{grid-template-columns:1fr}}

  /* Thank You overlay */
  #thanksWrap{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;z-index:1200}
  #thanksCard{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);max-width:560px;width:90%;text-align:center}
  .pop{animation:pop .35s ease}
  @keyframes pop{from{transform:translate(-50%,-50%) scale(.96);opacity:0}to{transform:translate(-50%,-50%) scale(1);opacity:1}}
</style>
</head>
<body>

<!-- Social icons left -->
<div class="social-left" aria-label="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„">
  <div class="stack card" style="padding:8px">
    <a href="https://wa.me/13139194272" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
    <a href="mailto:visa@alhijrahservices.com" title="Email"><i class="fa-solid fa-envelope"></i></a>
    <a href="https://alhijrahvisa.com" target="_blank" title="Website"><i class="fa-solid fa-globe"></i></a>
    <a href="https://www.facebook.com/share/19gTVpmjVo/" target="_blank" title="Facebook"><i class="fab fa-facebook-f"></i></a>
    <a href="https://www.instagram.com/alhijrahservices/" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
  </div>
</div>

<div class="container">
  <div class="card">
    <h1>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‡Ø¬Ø±Ø© Ø§Ù„Ø°ÙƒÙŠØ© â€“ Alhijrah Visa & Immigration Services</h1>
    <p class="tagline">
      Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù€ <b>Alhijrah Visa & Immigration Services</b><br>
      Ø­ÙŠØ« ØªÙ„ØªÙ‚ÙŠ Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…Ø¹ Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„ØªÙ‚Ø¯ÙŠÙ… ØªØ¬Ø±Ø¨Ø© Ù‡Ø¬Ø±Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©ØŒ Ù…ÙˆØ«ÙˆÙ‚Ø©ØŒ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©.
    </p>

    <div class="progress"><div id="bar" class="bar"></div></div>

    <!-- Step 1 -->
    <section id="step1">
      <div class="row col-3">
        <div class="colspan">
          <label for="country">Ø§Ù„Ø¯ÙˆÙ„Ø©/Ø§Ù„ØªØµÙ†ÙŠÙ</label>
          <select id="country" required>
            <option value="" selected disabled>â€” Ø§Ø®ØªØ± â€”</option>
            <option value="usa">Ø£Ù…Ø±ÙŠÙƒØ§</option>
            <option value="canada">ÙƒÙ†Ø¯Ø§</option>
            <option value="newzealand">Ù†ÙŠÙˆØ²ÙŠÙ„Ù†Ø¯Ø§</option>
            <option value="australia">Ø£Ø³ØªØ±Ø§Ù„ÙŠØ§</option>
            <option value="yemen">Ø§Ù„ÙŠÙ…Ù† (Ø¬ÙˆØ§Ø²Ø§Øª/Ø¥Ù‚Ø§Ù…Ø§Øª)</option>
            <option value="translation">Ø§Ù„ØªØ±Ø¬Ù…Ø©</option>
            <option value="notarization">Ø§Ù„ØªÙˆØ«ÙŠÙ‚</option>
            <option value="powerofattorney">Ø§Ù„ØªÙˆÙƒÙŠÙ„ ÙˆØ§Ù„ØªØ¹Ù…ÙŠØ¯</option>
            <option value="hajj">Ø§Ù„Ø­Ø¬ ÙˆØ§Ù„Ø¹Ù…Ø±Ø©</option>
            <option value="flights">Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø·ÙŠØ±Ø§Ù†</option>
          </select>
          <div class="hint">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø«Ù… Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.</div>
        </div>
        <div class="colspan">
          <label for="svcSearch">Ø¨Ø­Ø« Ø¹Ù† Ø®Ø¯Ù…Ø©</label>
          <input id="svcSearch" placeholder="Ø§ÙƒØªØ¨ Ù…Ø«Ù„Ø§Ù‹: Ø³ÙŠØ§Ø­ÙŠØ©ØŒ ØªØ±Ø´ÙŠØ­ Ø¥Ù‚Ù„ÙŠÙ…ÙŠØŒ ØªÙˆØ«ÙŠÙ‚â€¦" />
        </div>
        <div class="toolbar" style="align-self:end">
          <button id="next1" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ â†’</button>
        </div>
      </div>

      <div class="services" id="svcBox" aria-live="polite" aria-atomic="true" style="margin-top:10px">
        <div class="muted">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙ Ø£Ùˆ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø¨Ø­Ø«â€¦</div>
        <div id="svcList"></div>
      </div>
    </section>

    <!-- Step 2 -->
    <section id="step2" style="display:none">
      <h2>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</h2>
      <div class="pill"><b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b>&nbsp;<span id="svcNamePill">â€”</span></div>
      <div id="reqDocs" class="hint"></div>

      <div class="row col-2" style="margin-top:8px">
        <div>
          <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
          <input id="fullName" required placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ø²" />
        </div>
        <div>
          <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
          <input id="email" type="email" required placeholder="example@mail.com" />
        </div>
        <div>
          <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
          <input id="phone" required placeholder="+1313XXXXXXXX Ø£Ùˆ 00966XXXXXXX" />
          <div class="hint">ÙŠÙØ³Ù…Ø­ Ø¨ØµÙŠØºØ© + Ø£Ùˆ 00ØŒ 8â€“15 Ø±Ù‚Ù….</div>
        </div>
        <div>
          <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="city" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø¯ÙŠØ±Ø¨ÙˆØ±Ù†â€¦" />
        </div>
      </div>

      <label for="details">ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <textarea id="details" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªØ³Ø§Ø¹Ø¯Ù†Ø§ (ØªÙˆØ§Ø±ÙŠØ®ØŒ Ø£Ø±Ù‚Ø§Ù… Ø¥ÙŠØµØ§Ù„Ø§ØªØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª)â€¦"></textarea>

      <label for="files">Ø¥Ø±ÙØ§Ù‚ Ù…Ø³ØªÙ†Ø¯Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="files" type="file" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
      <div class="muted" id="fileMeta">Ù„Ù… ÙŠØªÙ… Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.</div>
      <div class="files" id="fileList"></div>

      <div class="toolbar" style="margin-top:10px">
        <button id="prev2" class="btn sec">Ø±Ø¬ÙˆØ¹</button>
        <button id="next2" class="btn">Ù…Ø±Ø§Ø¬Ø¹Ø© â†’</button>
      </div>
    </section>

    <!-- Step 3 -->
    <section id="step3" style="display:none">
      <h2>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
      <div id="reviewBox" class="card" style="background:#041c3f"></div>
      <div class="toolbar" style="margin-top:10px">
        <button id="prev3" class="btn sec">ØªØ¹Ø¯ÙŠÙ„</button>
        <button id="submit" class="btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>
      </div>

      <!-- Jotform controls -->
      <div class="toolbar" style="margin-top:10px; justify-content:flex-start">
        <a id="btnJotPrefill" class="btn sec" target="_blank" rel="noopener"><i class="fa-solid fa-up-right-from-square"></i> ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Jotform (Ù…Ø¹Ø¨Ø£)</a>
        <a id="btnJotTable" class="btn sec" target="_blank" rel="noopener"><i class="fa-solid fa-table"></i> Jotform Table</a>
        <a id="btnJotBoard" class="btn sec" target="_blank" rel="noopener"><i class="fa-solid fa-grip"></i> Jotform Board</a>
      </div>
      <div class="hint">Ø²Ø± â€œJotform (Ù…Ø¹Ø¨Ø£)â€ ÙŠÙØªØ­ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø¹Ù„Ù‰ Jotform Ù…Ø¹ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ø¨Ø±ÙŠØ¯/Ø§Ù„Ù‡Ø§ØªÙ/Ø§Ù„Ø®Ø¯Ù…Ø©. ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…ÙØ±ÙƒÙ‘Ø¨ (Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„/Ø§Ù„Ø£Ø®ÙŠØ±).</div>
    </section>

    <!-- Client Card -->
    <section id="clientCard" class="card">
      <h2 style="margin-top:0">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (VIP)</h2>
      <div class="row col-2" style="align-items:center">
        <div class="toolbar" style="gap:12px;align-items:center">
          <img class="avatar" id="avatar" src="https://via.placeholder.com/88x88.png?text=AL" alt="Avatar" />
          <div>
            <div class="pill"><b>TrackID:</b>&nbsp;<span id="trackId">â€”</span></div>
            <div class="pill"><b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b>&nbsp;<span id="svcOut">â€”</span></div>
          </div>
        </div>
        <div id="qrcode" style="justify-self:end"></div>
      </div>
      <div id="cardData" style="margin-top:8px"></div>
      <div class="toolbar" style="margin-top:12px">
        <button id="dlPDF" class="btn"><i class="fa-solid fa-file-arrow-down"></i> ØªÙ†Ø²ÙŠÙ„ PDF</button>
        <a id="waShare" class="btn sec" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i> Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</a>
        <button id="printCard" class="btn sec"><i class="fa-solid fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </section>

  </div>
</div>

<!-- Footer -->
<footer>
  <div class="footer-inner">
    <div class="footer-grid">
      <div>
        <div class="footer-title">Alhijrah Visa & Immigration Services</div>
        <div class="muted">Ù†ÙØ¹ÙŠØ¯ ØªØ¹Ø±ÙŠÙ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù‡Ø¬Ø±Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø© ÙˆØ§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ©.</div>
      </div>
      <div class="contact">
        <div class="footer-title">ØªÙˆØ§ØµÙ„</div>
        <a href="https://wa.me/13139194272" target="_blank"><i class="fab fa-whatsapp"></i><span> WhatsApp</span></a>
        <a href="mailto:visa@alhijrahservices.com"><i class="fa-solid fa-envelope"></i><span> visa@alhijrahservices.com</span></a>
        <a href="tel:+13139194272"><i class="fa-solid fa-phone"></i><span> +1 (313) 919-4272</span></a>
      </div>
      <div class="contact">
        <div class="footer-title">Ø±ÙˆØ§Ø¨Ø·</div>
        <a href="https://alhijrahvisa.com" target="_blank"><i class="fa-solid fa-globe"></i><span> Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ</span></a>
        <a href="https://www.facebook.com/share/19gTVpmjVo/" target="_blank"><i class="fab fa-facebook-f"></i><span> Facebook</span></a>
        <a href="https://www.instagram.com/alhijrahservices/" target="_blank"><i class="fab fa-instagram"></i><span> Instagram</span></a>
      </div>
    </div>
    <div class="copy">Â© <span id="yr"></span> Alhijrah Services â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
  </div>
</footer>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Thank You Overlay -->
<div id="thanksWrap">
  <div id="thanksCard" class="card pop">
    <h2>ğŸ‰ Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ!</h2>
    <p style="margin:.5rem 0 1rem">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³Ù†Ø±Ø§Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆÙ†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ù‹Ø§.</p>
    <div class="toolbar" style="justify-content:center">
      <button id="btnViewCard" class="btn">Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
      <button id="btnCloseThanks" class="btn sec">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
</div>

<script>
/** ========= CONFIG =========
 *  Sheets (Apps Script endpoint) + EmailJS + Jotform (structured name)
 */
const INTEGRATIONS = {
  EMAILJS: {
    PUBLIC_KEY: "0Cub6o0xkk9eYTe90",
    SERVICE_ID: "service_flhs3e5",
    TEMPLATE_ID: "template_mguzw2l"
  },
  APPS_SCRIPT: {
    // Your live Sheets endpoint (writes to tab "Form Responses")
    ENDPOINT: "https://script.google.com/macros/s/AKfycbwzXuSJNyPmlhHihgFelbPAcs3f0bHZTntXPC0dMOBiPCq3zpKXHaX_ITHco5xLPgcheA/exec"
  },
  JOTFORM: {
    // Your real links
    FORM_URL: "https://form.jotform.com/AlhijrahServices/Alhijrahsmartportal",
    BOARD_URL: "https://www.jotform.com/boards/252149440362049",
    TABLE_URL: "https://www.jotform.com/tables/250817936172058",

    // Structured name mapping (first/last)
    FIELD_MAP: {
      "name[first]": true,
      "name[last]": true,
      email: "email",
      phone: "phone",
      city: "city",
      service: "service"
    },

    // Open Jotform in a new tab right after submit (prefilled)
    AUTO_OPEN_ON_SUBMIT: true
  }
};

/** ========= Services data ========= */
const DATA = {
  usa: [
    {n:"Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© (B1/B2)", req:["Ø¬ÙˆØ§Ø² Ø³Ø§Ø±ÙŠ","ØµÙˆØ±Ø© 2Ã—2 (600Ã—600)","ÙƒØ´Ù Ø­Ø³Ø§Ø¨ 3â€“6 Ø£Ø´Ù‡Ø±","Ø®Ø·Ø© Ø³ÙØ± Ù…Ø¨Ø¯Ø¦ÙŠØ©"]},
    {n:"Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© (F-1)", req:["Ù‚Ø¨ÙˆÙ„ Ø¬Ø§Ù…Ø¹ÙŠ/Ù…Ø¹Ù‡Ø¯ + I-20","Ø¥Ø«Ø¨Ø§Øª Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø² Ø³Ø§Ø±ÙŠ","ØµÙˆØ±Ø© 2Ã—2"]},
    {n:"Ø§Ù„Ù‡Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©", req:["Ø´Ù‡Ø§Ø¯Ø© Ø²ÙˆØ§Ø¬/Ù…ÙŠÙ„Ø§Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©","Ø¥Ø«Ø¨Ø§Øª Ø¥Ù‚Ø§Ù…Ø©/Ø¯Ø®Ù„ Ù„Ù„Ù…ÙƒÙÙ‘ÙÙ„","Ø¬ÙˆØ§Ø²Ø§Øª"]},
    {n:"Ø§Ù„Ù‡Ø¬Ø±Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©", req:["Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©","Ø´Ù‡Ø§Ø¯Ø§Øª ÙˆØ®Ø¨Ø±Ø§Øª","Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¥Ù† ÙˆÙØ¬Ø¯Øª"]},
    {n:"Ø§Ù„Ù„Ø¬ÙˆØ¡ ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©", req:["Ø±ÙˆØ§ÙŠØ© ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…ÙˆØ«Ù‚Ø©","Ø£Ø¯Ù„Ø© ÙˆÙ…Ø³ØªÙ†Ø¯Ø§Øª Ø¯Ø§Ø¹Ù…Ø© (Ø¥Ù† ÙˆÙØ¬Ø¯Øª)"]}
  ],
  canada: [
    {n:"Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø±Ø© (Express Entry)", req:["IELTS/CELPIP","ECA","Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø§Ù„Ù‡Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©", req:["Ø¥Ø«Ø¨Ø§Øª Ø¹Ù„Ø§Ù‚Ø©","Ø¥Ø«Ø¨Ø§Øª Ø¯Ø¹Ù… Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø²Ø§Øª"]},
    {n:"Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ±Ø´ÙŠØ­ Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠ (PNP)", req:["Ù…Ù„Ù Express Entry Ø£Ùˆ Ù…Ø³ØªÙ‚Ù„","Ø®Ø¨Ø±Ø©/ØªØ¹Ù„ÙŠÙ… Ù…Ù†Ø§Ø³Ø¨","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¯ÙˆÙ„ÙŠÙŠÙ†", req:["Ù‚Ø¨ÙˆÙ„ Ø¯Ø±Ø§Ø³ÙŠ","Ø¥Ø«Ø¨Ø§Øª Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø²","ØµÙˆØ±"]},
    {n:"ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©", req:["Ø¬ÙˆØ§Ø²/Ø¥Ù‚Ø§Ù…Ø© Ø³Ø§Ø±ÙŠØ©","Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯","ØµÙˆØ± Ø­Ø¯ÙŠØ«Ø©"]}
  ],
  newzealand: [
    {n:"Ø¹Ù…Ø§Ù„Ø© Ù…Ù‡Ø±Ø©", req:["Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©","Ø´Ù‡Ø§Ø¯Ø§Øª","Ø¥Ø«Ø¨Ø§Øª Ø®Ø¨Ø±Ø©","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø¹Ø§Ø¦Ù„ÙŠØ©", req:["Ø¥Ø«Ø¨Ø§Øª Ø¹Ù„Ø§Ù‚Ø©","Ø¬ÙˆØ§Ø²Ø§Øª","ØµÙˆØ±"]},
    {n:"Ø³ÙŠØ§Ø­ÙŠØ©", req:["Ø®Ø·Ø© Ø³ÙØ±","Ø¥Ø«Ø¨Ø§Øª Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø¯Ø±Ø§Ø³ÙŠØ©", req:["Ù‚Ø¨ÙˆÙ„","Ø¥Ø«Ø¨Ø§Øª Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø§Ø³ØªØ«Ù…Ø§Ø±", req:["Ø®Ø·Ø© Ø§Ø³ØªØ«Ù…Ø§Ø±","Ø¥Ø«Ø¨Ø§Øª Ø£ØµÙˆÙ„","Ø¬ÙˆØ§Ø²"]}
  ],
  australia: [
    {n:"Ù…Ù‡Ø§Ø±ÙŠØ©", req:["EOI","IELTS/PTE","Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©","Ø´Ù‡Ø§Ø¯Ø§Øª"]},
    {n:"Ø¹Ø§Ø¦Ù„ÙŠØ©", req:["Ø¥Ø«Ø¨Ø§Øª Ø¹Ù„Ø§Ù‚Ø©","Ø¯Ø¹Ù… Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø³ÙŠØ§Ø­ÙŠØ©", req:["Ø®Ø·Ø© Ø³ÙØ±","Ø¥Ø«Ø¨Ø§Øª Ù…Ø§Ù„ÙŠ","Ø¬ÙˆØ§Ø²"]},
    {n:"Ø¹Ù…Ù„ Ù…Ø¤Ù‚Øª", req:["Ø¹Ø±Ø¶ Ø¹Ù…Ù„","Ø³Ø¬Ù„ Ø®Ø¨Ø±Ø©","Ø¬ÙˆØ§Ø²"]},
    {n:"Ù„Ø¬ÙˆØ¡", req:["Ù…Ø°ÙƒØ±Ø§Øª Ø­Ø§Ù„Ø©","Ø£Ø¯Ù„Ø© Ø¯Ø§Ø¹Ù…Ø©","Ø¬ÙˆØ§Ø² (Ø¥Ù† ÙˆÙØ¬Ø¯)"]}
  ],
  yemen: [
    {n:"Ø¥ØµØ¯Ø§Ø± Ø¬ÙˆØ§Ø²", req:["Ø§Ø³ØªÙ…Ø§Ø±Ø©","ØµÙˆØ± Ø´Ø®ØµÙŠØ©","Ø±Ø³ÙˆÙ…"]},
    {n:"ØªØ¬Ø¯ÙŠØ¯ Ø¬ÙˆØ§Ø²", req:["Ø§Ù„Ø¬ÙˆØ§Ø² Ø§Ù„Ù‚Ø¯ÙŠÙ…","ØµÙˆØ±","Ø±Ø³ÙˆÙ…"]},
    {n:"Ø¥Ù‚Ø§Ù…Ø§Øª", req:["Ù†Ù…ÙˆØ°Ø¬","Ø¥Ø«Ø¨Ø§Øª Ø³ÙƒÙ†","ØµÙˆØ±"]},
    {n:"ØªØ³Ø¬ÙŠÙ„ ÙˆÙ„Ø§Ø¯Ø©", req:["Ø´Ù‡Ø§Ø¯Ø© Ù…Ø³ØªØ´ÙÙ‰","Ù‡ÙˆÙŠØ§Øª Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†","ØµÙˆØ±"]},
    {n:"ØªØ³Ø¬ÙŠÙ„ ÙˆÙØ§Ø©", req:["Ø´Ù‡Ø§Ø¯Ø© ÙˆÙØ§Ø©","Ù‡ÙˆÙŠØ© Ù‚Ø±ÙŠØ¨","Ø¥Ø«Ø¨Ø§Øª ØµÙ„Ø©"]}
  ],
  translation: [
    {n:"Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©", req:["Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„ÙˆØ§Ø¶Ø­","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„"]},
    {n:"ØªØ±Ø¬Ù…Ø© Ø´Ù‡Ø§Ø¯Ø§Øª", req:["Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©","Ø£ÙŠ Ù…ØªØ·Ù„Ø¨Ø§Øª ØªØµØ¯ÙŠÙ‚"]},
    {n:"ØªØ±Ø¬Ù…Ø© Ù…Ø¹ØªÙ…Ø¯Ø©", req:["Ø§Ù„Ù…Ø³ØªÙ†Ø¯ + Ø§Ù„ØºØ±Ø¶ Ù…Ù† Ø§Ù„ØªØ±Ø¬Ù…Ø©"]},
    {n:"ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ©", req:["Ø§Ù„Ù…Ø¬Ø§Ù„ ÙˆØ§Ù„Ù…ÙˆØ¹Ø¯"]},
    {n:"ØªØ±Ø¬Ù…Ø© Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø³Ù…ÙŠØ©", req:["Ø§Ù„Ù…Ø³ØªÙ†Ø¯","Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…"]}
  ],
  notarization: [
    {n:"ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¹Ù‚ÙˆØ¯", req:["Ù…Ø³ÙˆØ¯Ø© Ø§Ù„Ø¹Ù‚Ø¯","Ù‡ÙˆÙŠØ§Øª Ø§Ù„Ø£Ø·Ø±Ø§Ù"]},
    {n:"Ø§Ù„ØªØµØ¯ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹", req:["Ù‡ÙˆÙŠØ© Ø³Ø§Ø±ÙŠØ©","Ø­Ø¶ÙˆØ± ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©"]},
    {n:"ØªÙˆÙƒÙŠØ¯ ØµØ­Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª", req:["Ø£ØµÙ„/ØµÙˆØ±Ø© Ø·Ø¨Ù‚ Ø§Ù„Ø£ØµÙ„","Ø¨ÙŠØ§Ù†Ø§Øª"]},
    {n:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙˆÙƒØ§Ù„Ø§Øª", req:["Ù†Øµ Ø§Ù„ÙˆÙƒØ§Ù„Ø©","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙƒÙ„/Ø§Ù„ÙˆÙƒÙŠÙ„"]},
    {n:"ØªÙˆØ«ÙŠÙ‚ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©", req:["Ø£ØµÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©","Ù‡ÙˆÙŠØ§Øª"]}
  ],
  powerofattorney: [
    {n:"ØªÙˆÙƒÙŠÙ„ Ø¹Ø§Ù…", req:["Ù†Øµ Ø§Ù„ØªÙˆÙƒÙŠÙ„","Ù‡ÙˆÙŠØ§Øª"]},
    {n:"ØªÙˆÙƒÙŠÙ„ Ø®Ø§Øµ", req:["Ù†Øµ Ù…Ø­Ø¯Ø¯","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø·Ø±Ø§Ù"]},
    {n:"ØªØ¹Ù…ÙŠØ¯ Ù‚Ø§Ù†ÙˆÙ†ÙŠ", req:["Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ù…ÙŠØ¯","Ù‡ÙˆÙŠØ§Øª"]},
    {n:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙŠÙ„Ø§Øª", req:["Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ","Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø·Ø±Ø§Ù"]},
    {n:"ØµÙŠØ§ØºØ© Ø§Ù„ØªÙˆÙƒÙŠÙ„Ø§Øª", req:["Ø§Ù„ØºØ±Ø¶","Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª"]}
  ],
  hajj: [
    {n:"Ø­Ø¬", req:["Ø¬ÙˆØ§Ø²","ØµÙˆØ±","Ø­Ø²Ù…Ø© Ù…Ø®ØªØ§Ø±Ø©"]},
    {n:"Ø¹Ù…Ø±Ø©", req:["Ø¬ÙˆØ§Ø²","ØµÙˆØ±","Ø­Ø¬Ø² ÙÙ†Ø¯Ù‚ÙŠ"]},
    {n:"Ø¬ÙˆÙ„Ø§Øª Ø¯ÙŠÙ†ÙŠØ©", req:["Ø§Ù„ÙˆØ¬Ù‡Ø§Øª","Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯"]},
    {n:"Ø¥Ù‚Ø§Ù…Ø©", req:["ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆØµÙˆÙ„","Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø²Ù„Ø§Ø¡"]},
    {n:"Ù†Ù‚Ù„", req:["Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ","Ø§Ù„Ù…Ø¯Ù†"]}
  ],
  flights: [
    {n:"ØªØ°Ø§ÙƒØ± Ø¯Ø§Ø®Ù„ÙŠØ©", req:["ØªÙˆØ§Ø±ÙŠØ®","Ù…Ø¯Ù†"]},
    {n:"ØªØ°Ø§ÙƒØ± Ø¯ÙˆÙ„ÙŠØ©", req:["Ø¬ÙˆØ§Ø²","ØªÙˆØ§Ø±ÙŠØ®","Ù…Ø¯Ù†"]},
    {n:"ØªØ°Ø§ÙƒØ± Ø¹Ø§Ø¦Ù„ÙŠØ©", req:["Ø¹Ø¯Ø¯ Ø§Ù„Ø±ÙƒØ§Ø¨","Ø£Ø¹Ù…Ø§Ø±"]},
    {n:"Ø·ÙŠØ±Ø§Ù† Ø¹Ø§Ø±Ø¶", req:["ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©","Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯"]},
    {n:"ØªØ¹Ø¯ÙŠÙ„ ØªØ°ÙƒØ±Ø©", req:["Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²","Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ø¯ÙŠØ¯"]}
  ]
};

const MAX_FILE = 5*1024*1024;
const OK_EXT = ['pdf','doc','docx','jpg','jpeg','png'];

/** ====== Elements ====== */
const yr = document.getElementById('yr');
const bar = document.getElementById('bar');
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');
const country = document.getElementById('country');
const svcSearch = document.getElementById('svcSearch');
const svcBox = document.getElementById('svcBox');
const svcList = document.getElementById('svcList');
const next1 = document.getElementById('next1');

const svcNamePill = document.getElementById('svcNamePill');
const reqDocs = document.getElementById('reqDocs');
const fullName = document.getElementById('fullName');
const email = document.getElementById('email');
const phone = document.getElementById('phone');
const city = document.getElementById('city');
const details = document.getElementById('details');
const files = document.getElementById('files');
const fileList = document.getElementById('fileList');
const fileMeta = document.getElementById('fileMeta');
const prev2 = document.getElementById('prev2');
const next2 = document.getElementById('next2');

const reviewBox = document.getElementById('reviewBox');
const prev3 = document.getElementById('prev3');
const submitBtn = document.getElementById('submit');

const clientCard = document.getElementById('clientCard');
const trackIdEl = document.getElementById('trackId');
const svcOut = document.getElementById('svcOut');
const qrcodeEl = document.getElementById('qrcode');
const cardData = document.getElementById('cardData');
const dlPDF = document.getElementById('dlPDF');
const waShare = document.getElementById('waShare');
const printCard = document.getElementById('printCard');

const toast = document.getElementById('toast');

const thanksWrap = document.getElementById('thanksWrap');
const btnViewCard = document.getElementById('btnViewCard');
const btnCloseThanks = document.getElementById('btnCloseThanks');

let selectedService = null;

/** ====== Helpers ====== */
function showToast(msg, ms=2200){ toast.textContent=msg; toast.style.display='block'; setTimeout(()=>toast.style.display='none',ms); }
function setStep(i){
  const steps=[step1,step2,step3];
  steps.forEach((s,idx)=> s.style.display = idx===i ? 'block' : 'none');
  bar.style.width = (i/(steps.length-1))*100 + '%';
  window.scrollTo({top:0,behavior:'smooth'});
}
function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function phoneValid(v){ return /^(\+|00)?\d{8,15}$/.test((v||'').trim()); }
yr.textContent = new Date().getFullYear();

/** ====== Services + search ====== */
function allServicesOfCountry(){
  const c = country.value; if(!c || !DATA[c]) return [];
  return DATA[c];
}
function renderServices(){
  const list = allServicesOfCountry();
  const q = (svcSearch.value||'').trim().toLowerCase();
  let filt = list;
  if(q){
    filt = list.filter(s => s.n.toLowerCase().includes(q) || (s.req||[]).some(r=>r.toLowerCase().includes(q)));
  }
  svcList.innerHTML = '';
  if(!country.value){ svcBox.querySelector('.muted').textContent='Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø£ÙˆÙ„Ø§Ù‹â€¦'; return; }
  if(filt.length===0){
    svcBox.querySelector('.muted').textContent='Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«. Ø¬Ø±Ù‘Ø¨ ÙƒÙ„Ù…Ø© Ø£Ø®Ø±Ù‰.';
    return;
  }
  svcBox.querySelector('.muted').textContent = '';
  filt.forEach(s=>{
    const row = document.createElement('div'); row.className='svc';
    const span = document.createElement('span'); span.textContent = s.n;
    const btn = document.createElement('button'); btn.className='btn sec'; btn.textContent='Ø§Ø®ØªÙŠØ§Ø±';
    btn.onclick = ()=> selectService(s);
    row.append(span, btn);
    svcList.appendChild(row);
  });
}
country.addEventListener('change', renderServices);
svcSearch.addEventListener('input', debounce(renderServices, 200));

function selectService(svc){
  selectedService = svc;
  svcNamePill.textContent = svc.n;
  reqDocs.innerHTML = `<b>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©:</b> ${svc.req.map(r=>`<span class="pill">${esc(r)}</span>`).join(' ')}`;
  setStep(1); // Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  step1.style.display='none'; step2.style.display='block';
  showToast('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©: ' + svc.n);
}

/** ====== Files: validate + chips ====== */
files.addEventListener('change', ()=>{
  fileList.innerHTML = '';
  let total = 0; let ok = true;
  [...files.files].forEach(f=>{
    const ext = (f.name.split('.').pop()||'').toLowerCase();
    total += f.size;
    if(!OK_EXT.includes(ext) || f.size>MAX_FILE) ok=false;
    const chip = document.createElement('div'); chip.className='file';
    chip.textContent = `${f.name} â€” ${(f.size/1024).toFixed(0)} KB`;
    fileList.appendChild(chip);
  });
  fileMeta.textContent = files.files.length
    ? `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª: ${files.files.length} â€” Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒÙ„ÙŠ ~ ${(total/1024/1024).toFixed(2)} MB`
    : 'Ù„Ù… ÙŠØªÙ… Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯.';
  if(!ok) showToast('ØªØ­Ø°ÙŠØ±: Ù†ÙˆØ¹/Ø­Ø¬Ù… Ù…Ù„Ù ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­. Ø§Ù„Ø­Ø¯ 5MB ÙˆØ§Ù„ØµÙŠØº PDF/DOC/DOCX/JPG/PNG.');
});

/** ====== Step nav ====== */
next1.addEventListener('click', ()=>{
  if(!country.value){ showToast('Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø£ÙˆÙ„Ø§Ù‹.'); return; }
  if(!selectedService){ showToast('Ø§Ø®ØªØ± Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.'); return; }
  setStep(1);
});
prev2.addEventListener('click', ()=> setStep(0));
next2.addEventListener('click', ()=>{
  if(!fullName.value.trim() || !email.validity.valid || !phoneValid(phone.value)){
    showToast('ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.');
    if(!phoneValid(phone.value)) phone.focus();
    return;
  }
  buildReview();
  setStep(2);
});
prev3.addEventListener('click', ()=> setStep(1));

/** ====== Review ====== */
function buildReview(){
  const det = esc(details.value).replace(/\n/g,'<br>');
  const fileNames = [...files.files].map(f=>`<li>${esc(f.name)}</li>`).join('');
  const filesHTML = files.files.length ? `<ul>${fileNames}</ul>` : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
  reviewBox.innerHTML = `
    <p><b>Ø§Ù„Ø®Ø¯Ù…Ø©:</b> ${esc(selectedService?.n||'â€”')}</p>
    <p><b>Ø§Ù„Ø§Ø³Ù…:</b> ${esc(fullName.value)}</p>
    <p><b>Ø§Ù„Ø¨Ø±ÙŠØ¯:</b> ${esc(email.value)}</p>
    <p><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${esc(phone.value)}</p>
    <p><b>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</b> ${esc(city.value||'-')}</p>
    <p><b>ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©:</b></p><div>${det||'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</div>
    <p><b>Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª:</b> ${filesHTML}</p>
  `;

  // prep Jotform links
  document.getElementById('btnJotPrefill').href = buildJotPrefillURL();
  document.getElementById('btnJotTable').href   = INTEGRATIONS.JOTFORM.TABLE_URL;
  document.getElementById('btnJotBoard').href   = INTEGRATIONS.JOTFORM.BOARD_URL;
}

/** ====== Submit: Thank-you + Card + Integrations ====== */
submitBtn.addEventListener('click', async ()=>{
  const track = makeTrackId();

  // Thank-you
  thanksWrap.style.display='block';

  // Build card
  showClientCard(track);

  // Fire integrations (EmailJS + GAS)
  fireIntegrations(track).catch(err=>console.warn('Integrations error', err));

  // Auto open Jotform prefilled
  if (INTEGRATIONS.JOTFORM.AUTO_OPEN_ON_SUBMIT) {
    const url = buildJotPrefillURL(track);
    window.open(url, '_blank', 'noopener');
  }
});

btnViewCard.onclick = ()=> {
  thanksWrap.style.display='none';
  clientCard.scrollIntoView({behavior:'smooth', block:'center'});
};
btnCloseThanks.onclick = ()=> { thanksWrap.style.display='none'; };

function makeTrackId(){
  const d=new Date(), y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
  return `ALH-${y}${m}${dd}-${Math.floor(Math.random()*9000+1000)}`;
}
function showClientCard(track){
  trackIdEl.textContent = track;
  svcOut.textContent = selectedService?.n||'â€”';
  const qrText = location.origin + location.pathname + '?track=' + encodeURIComponent(track);
  qrcodeEl.innerHTML = ''; new QRCode(qrcodeEl, {text:qrText, width:110, height:110, colorDark:"#000", colorLight:"#fff"});
  cardData.innerHTML = `
    <div class="row col-2">
      <div>
        <p><b>Ø§Ù„Ø§Ø³Ù…:</b> ${esc(fullName.value)}</p>
        <p><b>Ø§Ù„Ø¨Ø±ÙŠØ¯:</b> ${esc(email.value)}</p>
        <p><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${esc(phone.value)}</p>
      </div>
      <div>
        <p><b>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</b> ${esc(city.value||'-')}</p>
        <p><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${new Date().toLocaleDateString('ar')}</p>
        <p><b>Ø§Ù„ÙˆÙ‚Øª:</b> ${new Date().toLocaleTimeString('ar')}</p>
      </div>
    </div>`;
  clientCard.style.display = 'block';

  waShare.href = `https://wa.me/13139194272?text=${encodeURIComponent('TrackID '+track+' â€” '+(fullName.value||'')+' â€” Ø®Ø¯Ù…Ø©: '+(selectedService?.n||''))}`;

  dlPDF.onclick = ()=> html2pdf().from(clientCard).set({margin:.4, filename:`ClientCard_${track}.pdf`, html2canvas:{scale:2}, jsPDF:{unit:'in',format:'a4'}}).save();
  printCard.onclick = ()=> window.print();
}

/** ====== Jotform Prefill URL (Structured name) ====== */
function buildJotPrefillURL(track){
  const F = INTEGRATIONS.JOTFORM.FIELD_MAP;
  const params = new URLSearchParams();

  // Split the full name for structured fields
  const full = (fullName.value || "").trim();
  const parts = full.split(/\s+/);
  const first = parts.shift() || "";
  const last  = parts.join(" ") || "";

  if ("name[first]" in F) params.set("name[first]", first);
  if ("name[last]"  in F) params.set("name[last]",  last);

  if (F.email)   params.set(F.email,   email.value || "");
  if (F.phone)   params.set(F.phone,   phone.value || "");
  if (F.city)    params.set(F.city,    city.value  || "");
  if (F.service) params.set(F.service, (selectedService?.n || ""));

  if (track) params.set("trackId", track); // optional track id

  return `${INTEGRATIONS.JOTFORM.FORM_URL}?${params.toString()}`;
}

/** ====== Integrations (EmailJS + Sheets) ====== */
function buildPayload(track){
  return {
    track_id: track,
    track_url: location.href,
    country: country.value,
    service: selectedService?.n || '',
    fullName: fullName.value,
    email: email.value,
    phone: phone.value,
    city: city.value,
    details: details.value,
    files_count: (files.files||[]).length
  };
}

async function fireIntegrations(track){
  const payload = buildPayload(track);

  // EmailJS
  try{
    if(window.emailjs && INTEGRATIONS.EMAILJS.PUBLIC_KEY){
      emailjs.init(INTEGRATIONS.EMAILJS.PUBLIC_KEY);
      await emailjs.send(INTEGRATIONS.EMAILJS.SERVICE_ID, INTEGRATIONS.EMAILJS.TEMPLATE_ID, payload);
      console.log('[EmailJS] sent');
    }
  }catch(e){ console.warn('[EmailJS] fail', e); }

  // Google Apps Script (Sheets)
  try{
    if(INTEGRATIONS.APPS_SCRIPT.ENDPOINT){
      await fetch(INTEGRATIONS.APPS_SCRIPT.ENDPOINT, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      console.log('[GAS] posted');
    }
  }catch(e){ console.warn('[GAS] fail', e); }
}

/** ====== Utils ====== */
function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }}

/** ====== Init ====== */
yr.textContent = new Date().getFullYear();
setStep(0);
renderServices();
</script>
</body>
</html>
